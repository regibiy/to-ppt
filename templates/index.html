{% extends "base.html" %} {% block title %} Generate PPT {% endblock %} {% block content %}
<div class="container mb-4" style="margin-top: 5rem">
  <form action="{{ url_for('generate') }}" method="post" enctype="multipart/form-data" autocomplete="off">
    <div class="row justify-content-center">
      <div class="col-12 col-sm-12 col-md-8 col-lg-6">
        <div class="mb-3">
          <label for="caseNumber" class="form-label">Case Number <span class="text-danger">*</span></label>
          <input type="text" class="form-control" id="caseNumber" name="caseNumber" placeholder="Masukkan Case Number di Sini" required />
        </div>
        <div class="mb-3">
          <label for="unitModel" class="form-label">Unit Model <span class="text-danger">*</span></label>
          <input type="text" class="form-control" id="unitModel" name="unitModel" placeholder="Masukkan Unit Model di Sini" required />
        </div>
        <div class="mb-3">
          <label for="serialNumber" class="form-label">Serial Number <span class="text-danger">*</span></label>
          <input type="text" class="form-control" id="serialNumber" name="serialNumber" placeholder="Masukkan Serial Number di Sini" required />
        </div>
        <div class="mb-3">
          <label for="claimNumber" class="form-label">Claim Number</label>
          <input type="text" class="form-control" id="claimNumber" name="claimNumber" placeholder="Masukkan Claim Number di Sini" />
        </div>
        <div class="mb-3">
          <div id="previewWO">
            <img src="" alt="Preview Work Order" id="previewWorkOrder" class="img-thumbnail mb-3" width="200" height="200" />
          </div>
          <label for="WO" class="form-label">Foto Form Work Order</label>
          <input type="file" name="WO" id="WO" class="form-control" accept="image/*" />
        </div>
        <hr />
        <div class="text-end mb-3">
          <button type="button" id="addPhoto" class="btn btn-success">Tambah Foto Unit</button>
        </div>
        <div id="unitPhoto"></div>
        <div class="text-center">
          <button type="submit" name="submitButton" id="submitButton" class="btn btn-success">Download PPT</button>
        </div>
      </div>
    </div>
  </form>
</div>
<script>
  const unitPhoto = document.getElementById("unitPhoto");

  function previewImage(previewArea) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      const preview = document.getElementById(previewArea);
      preview.src = e.target.result;
      preview.style.display = "block";
    };

    reader.readAsDataURL(file);
  }

  let counter = 0;

  function addImage() {
    counter++;

    const divider = document.createElement("div");
    divider.id = `unitPhotoChild${counter}`;
    divider.classList = "mb-3 border p-3 rounded";

    const labelInfo = document.createElement("label");
    labelInfo.htmlFor = `addInfo${counter}`;
    labelInfo.classList = "form-label";
    labelInfo.innerText = "Keterangan Foto";

    const inputInfo = document.createElement("input");
    inputInfo.type = "text";
    inputInfo.name = "addInfo[]";
    inputInfo.id = `addInfo${counter}`;
    inputInfo.classList = "form-control mb-3";

    const inputPhoto = document.createElement("input");
    inputPhoto.type = "file";
    inputPhoto.name = "addPhoto[]";
    inputPhoto.id = `addPhoto${counter}`;
    inputPhoto.accept = "image/*";
    inputPhoto.classList = "form-control mb-3";

    const previewPhoto = document.createElement("img");
    previewPhoto.src = "";
    previewPhoto.alt = "Preview Foto Unit";
    previewPhoto.id = `previewPhoto${counter}`;
    previewPhoto.width = 200;
    previewPhoto.height = 200;
    previewPhoto.classList = "img-thumbnail mb-3";

    const cancelButton = document.createElement("button");
    cancelButton.type = "button";
    cancelButton.id = `cancelButton${counter}`;
    cancelButton.innerText = "Hapus Foto Unit";
    cancelButton.classList = "btn btn-outline-danger";

    divider.append(labelInfo, inputInfo, previewPhoto, inputPhoto, cancelButton);
    unitPhoto.append(divider);

    inputPhoto.addEventListener("change", (event) => {
      previewImage(previewPhoto.id);
    });

    cancelButton.addEventListener("click", (event) => {
      divider.remove();
    });
  }

  const addPhoto = document.getElementById("addPhoto");
  addPhoto.addEventListener("click", (event) => {
    addImage();
  });

  document.getElementById("WO").addEventListener("change", (event) => {
    previewImage("previewWorkOrder");
  });
</script>
{% endblock %}
